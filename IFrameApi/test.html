<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- INSERT CUSTOMER'S CANVAS URL HERE! -->
    <!-- To the base URL of your CC instance add /Resources/SPEditor/Scripts/IFrame/IFrameApi.js -->
    <script type="text/javascript" id="CcIframeApiScript" src="https://192.168.137.10/cc/4.4.1/Resources/SPEditor/Scripts/IFrame/IframeApi.js"></script>
    <!-- -->

    <link rel="stylesheet" href="../assets/demo.css">
    <title>Test - Customer's Canvas</title>
    <script>
        // Set the definition of a design - templates, mockups, etc.
        const product = {
            "surfaces": [
                {
                    "printAreas": [
                        {
                            "designFile": "samples/test-page",
                            "designLocation": {
                                "X": "36",
                                "Y": "36"
                            }
                        }
                    ],
                    "mockup": {
                        "down": "samples/test-page"
                    }
                }
            ]
        };

        // Set the editor configuration (mainly, user interface settings).
        const config = {
            "fontList": {
                "appFonts": [
                    "*"
                ]
            },
            "restoreProductOnReloadEnabled": false,
            "defaultAssetSelectWidget": "AssetManager",
            "assetSources": {
                "My files": {
                    "type": "PrivateSource",
                    "allowedExtensions": ["jpg", "jpeg", "png", "pdf"]
                }
            },
            "autoLoadUserInfo": true,
            "userInfo": {
                "Image": "public:samples/test-page/Image.jpg"
            },
            "canvas": {
                "shadowEnabled": false
            },
            "widgets": {
                "ObjectInspector": {
                    "position": "Right"
                },
                "AssetManager": {
                    "tabs": [{
                        "name": "My files",
                        "assetSourceInstance": "My files",
                        "iconClassName": "cc-icon-uploadable"
                    }]
                },
                "FinishButton": {
                    "mode": "Disabled"
                }
            }
        };
    </script>
</head>

<body>
    <header class="header">
        <div class="header__section header__section-logo">
            <a href="https://customerscanvas.com" target="_blank"><img class="header__logo" src="../assets/logo.svg"
                    alt="logo"></a>
        </div>
        <div class="header__section header__section-button">
            <button class="header__button" disabled id="finish">Download PDF</button>
        </div>
    </header>
    <main class="main">
        <div class="main__section main__section-iframe">
            <div class="main__iframe">
                <iframe id="editorFrame"></iframe>
                <div id="version-box" class="main__version">ver. </div>
            </div>
        </div>
    </main>

    <script type="text/ecmascript">
        document.addEventListener('DOMContentLoaded', async () => {

            document.getElementById("version-box").innerText = "version " + CustomersCanvas.VERSION;

            // Customer's Canvas is loaded with this line. See the JSON objects above for params.
            var editor = await CustomersCanvas.IframeApi.loadEditor(
                document.getElementById("editorFrame"), product, config);

            document.getElementById("finish").removeAttribute("disabled");
            document.getElementById('finish').addEventListener('click', async () => {
                let result = await editor.finishProductDesign();
                download(result.hiResOutputUrls[0]);
            });
        });

        // A helper function to download the URL
        // https://stackoverflow.com/a/49917066/4173445
        function download(url) {
            let link = document.createElement("a");
            link.style = "position:absolute; top:-99999999; left:-9999999; visibility:hidden";
            link.download = 'printfile.pdf';
            link.href = url;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

    </script>

</body>

</html>