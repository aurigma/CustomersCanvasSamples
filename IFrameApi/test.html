<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script type="text/javascript" id="CcIframeApiScript"
        src="https://localhost:4501/Resources/SPEditor/Scripts/IFrame/IframeApi.js"></script>
    <link rel="stylesheet" href="./assets/demo.css">
    <title>Demo-CC</title>
    <!-- START JSON SECTION -->
    <script>
        const product = {
            "surfaces": [
                {
                    "printAreas": [
                        {
                            "designFile": "samples/test-page",
                            "designLocation": {
                                "X": "36",
                                "Y": "36"
                            }
                        }
                    ],
                    "mockup": {
                        "down": "samples/test-page"
                    }
                }
            ]
        };

        const config = {
            "fontList": {
                "appFonts": [
                    "*"
                ]
            },
            "autoLoadUserInfo": true,
            "userInfo": {
                "Image": "public:samples/test-page/Image.jpg"
            },
            "widgets": {
                "ObjectInspector": {
                    "position": "Right"
                },
                "GalleryDialog": {
                    "tabs": [
                        {
                            "name": "My Files",
                            "type": "user",
                            "translationKey": "GalleryDialog.TAB_USER",
                            "canEdit": true,
                            "canUpload": true,
                            "actionMode": {
                                "psd": "design",
                                "svg": "vector"
                            }
                        }
                    ]
                },
                "FinishButton": {
                    "mode": "Disabled"
                }
            }
        };
    </script>
    <!-- END JSON SECTION -->
</head>

<body>
    <header class="header">
        <div class="header__section header__section-logo">
            <img class="header__logo" src="./assets/logo.svg" alt="logo">
        </div>
        <div class="header__section header__section-button">
            <button class="header__button" id="finish">Download PDF</button>
        </div>
    </header>
    <main class="main">
        <div class="main__section main__section-iframe">
            <div class="main__iframe">
                <iframe id="editorFrame"></iframe>
            </div>
        </div>
    </main>

    <script type="text/ecmascript">
        document.addEventListener('DOMContentLoaded', function () {
            function downloadPdf(hiresLink) {
                let link = document.createElement("a");
                link.style = "position:absolute; top:-99999999; left:-9999999; visibility:hidden";
                link.download = 'download.pdf';
                link.href = hiresLink;
                document.body.appendChild(link);
                link.click();
            };
            function loadProduct(product, config) {

                var editor = null;

                CustomersCanvas.IframeApi.loadEditor(document.getElementById("editorFrame"), product, config, function () {
                }).then(function (e) {
                    editor = e;
                }).catch(console.error.bind(console));

                document.getElementById('finish').addEventListener('click', () => {
                    editor.finishProductDesign()
                        .then(function (result) {
                            downloadPdf(result.hiResOutputUrls[0]);
                        })
                        .catch(function (error) {
                            console.error(error);
                        });
                });
            };
            loadProduct(product, config);
        });
    </script>

</body>

</html>